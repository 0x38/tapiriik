{% extends "site.html" %}
{% load services %}
{% load users %}
{% load displayutils %}
{% block title %}{% if user != none %}dashboard{% else %}sync your runs, rides & more{% endif %}{% endblock %}

{% block content %}
{% if user != none %}
		{% if user.Substitute %}
		<h1>Substituting user</h1>
		<a href="{% url 'diagnostics_unsu' %}">Return</a>
		<hr/>
		{% endif %}
		{% if user.ConnectedServices|length > 1 %}
			{% infotip connectedWillSync %}Connected services will be synchronized {% if user|has_active_payment %}automatically{% else %}when you click Synchronize now{% endif %}{% endinfotip %}
		{% else %}
			{% infotip connectOneMore %}Connected a second service to synchronize your activities to &amp; from{% endinfotip %}
		{% endif %}
		<div class="serviceButtonOuter">
			<div class="serviceButtonWrap">
			{% for connection in user.ConnectedServices|svc_populate_conns %}
				{% with svc=connection.Service %}
					{% if svc.ID not in config.withdrawn_services %}
						{% include "service-button.html" with provider=svc connection=connection %}
					{% endif %}
				{% endwith %}
			{% endfor %}
			</div>
		</div>
	{% if user.ConnectedServices|length > 1 %}
		<div class="syncButtonBlock">
			<div class="syncButtonAttachment left">Queueing to Synchronize</div><div class="syncButtonWrap"><div class="syncButton"><div class="syncButtonIcon"></div></div><div class="syncSettingsNubbin"><div class="syncSettingsNubbinIcon"></div></div></div><div class="syncButtonAttachment right">Attached info 10%</div>
		</div>
		<br/>
		<div class="syncSettingsBlock" ng-controller="SyncSettingsController">
			<div class="internalPopover">
				<div class="popoverOuterBorder">
					{[ config ]}
					<div class="popoverArrow"><div class="popoverArrowInner"></div></div>
					<div class="popoverInner">
						<form>
							<div class="syncSettingsCloze">
								Check for new activities <div class="selectWrap"><select ng-model="config.suppress_auto_sync"><option ng-value="false">automatically</option><option ng-value="true">manually</option></select></div>. Upload activities <div class="selectWrap" ng-model="config.sync_upload_delay"><select><option>as soon as possible</option><option>20 minutes</option><option>1 hour</option></select></div> after they finish, but skip them if they happened before <input type="text" placeholder="16 Nov 1885" ng-model="config.sync_skip_before_entry">.
							</div>
							<div style="text-align:center;">
								<button class="syncSettingsSaveButton">Save</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	{% endif %}
	{% if user.NonblockingSyncErrorCount > 0 %}
		<a href="{% url 'activities_dashboard' %}" style="color:#aaa; font-size:80%;">Some activities could not be synchronized.</a><br/>
	{% endif %}

	{% if user.ConnectedServices|length > 1 %}
		{% if user|has_active_payment %}
		{% else %}
			{% include "payment.html" %}
		{% endif %}
	{% endif %}

	{% for connection in user.ConnectedServices|svc_populate_conns %}
		{% with svc=connection.Service %}
			{% for error in connection.SyncErrors %}
				{% if error.UserException.InterventionRequired and error.Block %}
					{% include "service-blockingexception.html" with provider=svc connection=connection exception=error %}
				{% endif %}
			{% endfor %}
		{% endwith %}
	{% endfor %}

	{% for provider in user.ConnectedServices|svc_providers_except %}
		{% if provider.ID not in config.soft_launch and provider.ID not in config.withdrawn_services %}
			{% if forloop.first %}<hr>{% infotip connectMore %}You can synchronize more services by connecting them below{% endinfotip %}{% endif %}
			{% include "service-button.html" with provider=provider inactive=True %}
		{% endif %}
	{% endfor %}

{% else %}
<p class="splashPreamble">tapiriik synchronizes your fitness activities between Garmin Connect, RunKeeper, Strava, TrainingPeaks, SportTracks.mobi, Endomondo, RideWithGPS, and Dropbox<br/>
(your heart rate, cadence, power, and temperature data syncs too)</p>
	{% for provider in service_providers %}
		{% if provider.ID not in config.soft_launch and provider.ID not in config.withdrawn_services %}
			{% include "service-button.html" with provider=provider %}
		{% endif %}
	{% endfor %}
<p class="splashPreamble">Your email, password, and fitness data are kept safe - full details on the <a href="{% url "privacy" %}">privacy page</a>.</p>
{% endif %}
{% endblock %}