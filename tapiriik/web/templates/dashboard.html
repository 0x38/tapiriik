{% extends "site.html" %}
{% load services %}
{% load users %}
{% block title %}{% if user != none %}dashboard{% else %}sync your fitness activities{% endif %}{% endblock %}

{% block content %}
{% if user != none %}
		{% if user.Substitute %}
		<h1>Substituting user</h1>
		<a href="{% url 'diagnostics_unsu' %}">Return</a>
		<hr/>
		{% endif %}
		<div class="serviceButtonOuter">
			<div class="serviceButtonWrap">
			{% for connection in user.ConnectedServices|svc_populate_conns %}
			{% with svc=connection.Service %}
				{% include "service-button.html" with provider=svc connection=connection %}
				{% if svc.Configurable %}
					<noscript>
					<p><a href="/configure/{{ connection.Service }}">Configure {{ svc.DisplayName }} &raquo;</a></p>
					</noscript>
				{% endif %}
			{% endwith %}
			{% endfor %}
			</div>
		</div>
	{% if user.SyncErrorCount > 0 %}
	<hr/>
	<h2>Oh no!</h2>
	<p>
		Looks like there were some problems synchronizing your activities! <b>Nothing to be worried about, though</b>, I'll look what went wrong soon.</p>
		{% if not user.Email %}
		<form action="account/setemail" method="POST" style="text-align:center;">
			<input type="email" name="email" placeholder="your@email.com" style="text-align:center;"/><br/>
			<button type="submit">Save my email (optional)</button>
			{% csrf_token %}
		</form>
		<p><b>If you want to make my job easier</b>, you can enter your email here to have it associated with your account so I can contact you if needed. <b>This is entirely optional.</b>
		{% else %}
			<p><b>Your email has been associated with this account</b> - if I need any information from you to fix these errors, I'll drop you a line.</p>
		{% endif %}

	</p>
	{% comment %} It's entirely possible that the synchronization could be run again after an error - and it will with auto-sync, but it makes more sense that errors need to be resolved before continuing {% endcomment %}
	{% endif %}
	{% if user.ConnectedServices|length > 1 %}
		<div class="syncStatus" style="opacity:0;"><span id="syncStatusPreamble">Next synchronization in </span><a href="#" id="syncButton">a period of time</a></em></div>
	{% endif %}

	{% if user.ConnectedServices|length > 1 %}
		{% if user|has_active_payment %}
		{% else %}
			{% include "payment.html" %}
		{% endif %}
	{% endif %}
	{% for provider in user.ConnectedServices|svc_providers_except %}
		{% if provider.ID not in config.soft_launch %}
			{% if forloop.first %}<hr>{% endif %}
			{% include "service-button.html" with provider=provider inactive=True %}
		{% endif %}
	{% endfor %}

{% else %}
<p class="splashPreamble">tapiriik synchronizes your fitness activities between Garmin Connect, RunKeeper, Strava, Endomondo and Dropbox<br/>
(your heart rate, cadence, power, and temperature data syncs too)</p>
	{% for provider in service_providers %}
		{% if provider.ID not in config.soft_launch %}
			{% include "service-button.html" with provider=provider %}
		{% endif %}
	{% endfor %}
<p class="splashPreamble">Your email, password, and fitness data are kept safe - full details on the <a href="{% url "privacy" %}">privacy page</a>.</p>
{% endif %}
<p><b style="color:#800;">Service Advisory:</b> The interface (API) that tapiriik uses to synchronize activities with Strava was <strong>retired on June 30<sup>th</sup></strong>. <b>tapiriik will {% if user != None %}no longer be able to synchronize your activities to or from your Strava account.{% else %} no longer be able to connect to your Strava account to synchronize your activities{% endif %}</b>. There is currently no timeline for resuming Strava synchronizations.</p>

{% endblock %}